# =============================================
# SERVER CONFIGURATION
# =============================================
server.port=8900
server.forward-headers-strategy=framework

# =============================================
# SPRING APPLICATION
# =============================================
spring.application.name=api-gateway

# =============================================
# SPRING CLOUD GATEWAY - ROUTES
# =============================================
spring.cloud.gateway.discovery.locator.enabled=false
spring.cloud.gateway.discovery.locator.lower-case-service-id=true

# User Service Route
spring.cloud.gateway.routes[0].id=user-service
spring.cloud.gateway.routes[0].uri=lb://user-service
spring.cloud.gateway.routes[0].predicates[0]=Path=/api/user/**,/api/auth/**
spring.cloud.gateway.routes[0].filters[0]=StripPrefix=0
spring.cloud.gateway.routes[0].filters[1]=name=RequestRateLimiter, args.redis-rate-limiter.replenishRate=10, args.redis-rate-limiter.burstCapacity=20, args.redis-rate-limiter.requestedTokens=1
spring.cloud.gateway.routes[0].filters[2]=name=CircuitBreaker, args.name=userService, args.fallbackUri=forward:/fallback/user-service

# Order Service Route
spring.cloud.gateway.routes[1].id=order-service
spring.cloud.gateway.routes[1].uri=lb://order-service
spring.cloud.gateway.routes[1].predicates[0]=Path=/api/orders/**
spring.cloud.gateway.routes[1].filters[0]=StripPrefix=0
spring.cloud.gateway.routes[1].filters[1]=name=CircuitBreaker, args.name=orderService, args.fallbackUri=forward:/fallback/order-service

# Payment Service Route
spring.cloud.gateway.routes[2].id=payment-service
spring.cloud.gateway.routes[2].uri=lb://payment-service
spring.cloud.gateway.routes[2].predicates[0]=Path=/api/payment/**
spring.cloud.gateway.routes[2].filters[0]=StripPrefix=0
spring.cloud.gateway.routes[2].filters[1]=name=CircuitBreaker, args.name=paymentService, args.fallbackUri=forward:/fallback/payment-service

# Hotel Service Route
spring.cloud.gateway.routes[3].id=hotel-service
spring.cloud.gateway.routes[3].uri=lb://hotel-service
spring.cloud.gateway.routes[3].predicates[0]=Path=/api/rooms/**
spring.cloud.gateway.routes[3].filters[0]=StripPrefix=0

# Hotel Service Static Route
spring.cloud.gateway.routes[4].id=hotel-service-static
spring.cloud.gateway.routes[4].uri=lb://hotel-service
spring.cloud.gateway.routes[4].predicates[0]=Path=/uploads/**
spring.cloud.gateway.routes[4].filters[0]=StripPrefix=0

# Gateway HTTP Client Configuration
spring.cloud.gateway.httpclient.connect-timeout=2000
spring.cloud.gateway.httpclient.response-timeout=10s
spring.cloud.gateway.default-filters[0]=DedupeResponseHeader=Access-Control-Allow-Origin Access-Control-Allow-Credentials

# =============================================
# SPRING SECURITY - OAUTH2
# =============================================
spring.security.oauth2.resourceserver.jwt.issuer-uri=http://keycloak:8181/realms/hotelbooking
spring.security.oauth2.resourceserver.jwt.jwk-set-uri=http://keycloak:8181/realms/hotelbooking/protocol/openid-connect/certs

# =============================================
# SPRING DATA REDIS
# =============================================
spring.data.redis.repositories.enabled=false

# =============================================
# EUREKA CLIENT CONFIGURATION
# =============================================

eureka.client.service-url.defaultZone=http://eureka:password@localhost:8671/eureka/
eureka.client.registry-fetch-interval-seconds=10
eureka.client.initial-instance-info-replication-interval-seconds=5

eureka.instance.prefer-ip-address=true
eureka.instance.instance-id=${spring.application.name}:${server.port}
eureka.instance.lease-renewal-interval-in-seconds=10
eureka.instance.lease-expiration-duration-in-seconds=30
eureka.instance.hostname=api-gateway

# # =============================================
# # MANAGEMENT ENDPOINTS
# # =============================================
# management.endpoints.web.exposure.include=health,info,metrics,gateway,env
# management.endpoints.web.base-path=/actuator
# management.endpoints.enabled-by-default=true

# management.endpoint.health.enabled=true
# management.endpoint.health.show-details=always
# management.endpoint.health.show-components=always
# management.endpoint.metrics.enabled=true
# management.endpoint.gateway.enabled=true

# management.health.circuitbreakers.enabled=true
# management.health.redis.enabled=true

# # =============================================
# # DISTRIBUTED TRACING
# # =============================================
# management.tracing.sampling.probability=1.0
# management.tracing.propagation.type=B3
# management.tracing.baggage.remote-fields=version,environment
# management.zipkin.tracing.endpoint=http://zipkin:9411/api/v2/spans

# # =============================================
# # RESILIENCE4J CIRCUIT BREAKER
# # =============================================
# # User Service Circuit Breaker
# resilience4j.circuitbreaker.instances.userService.register-health-indicator=true
# resilience4j.circuitbreaker.instances.userService.sliding-window-type=COUNT_BASED
# resilience4j.circuitbreaker.instances.userService.sliding-window-size=10
# resilience4j.circuitbreaker.instances.userService.minimum-number-of-calls=5
# resilience4j.circuitbreaker.instances.userService.failure-rate-threshold=50
# resilience4j.circuitbreaker.instances.userService.wait-duration-in-open-state=10s
# resilience4j.circuitbreaker.instances.userService.permitted-number-of-calls-in-half-open-state=3

# # Order Service Circuit Breaker
# resilience4j.circuitbreaker.instances.orderService.register-health-indicator=true
# resilience4j.circuitbreaker.instances.orderService.sliding-window-type=COUNT_BASED
# resilience4j.circuitbreaker.instances.orderService.sliding-window-size=10
# resilience4j.circuitbreaker.instances.orderService.minimum-number-of-calls=5
# resilience4j.circuitbreaker.instances.orderService.failure-rate-threshold=50
# resilience4j.circuitbreaker.instances.orderService.wait-duration-in-open-state=10s

# # Payment Service Circuit Breaker
# resilience4j.circuitbreaker.instances.paymentService.register-health-indicator=true
# resilience4j.circuitbreaker.instances.paymentService.sliding-window-type=COUNT_BASED
# resilience4j.circuitbreaker.instances.paymentService.sliding-window-size=10
# resilience4j.circuitbreaker.instances.paymentService.minimum-number-of-calls=5
# resilience4j.circuitbreaker.instances.paymentService.failure-rate-threshold=50
# resilience4j.circuitbreaker.instances.paymentService.wait-duration-in-open-state=10s

# # Time Limiter Configuration
# resilience4j.timelimiter.instances.userService.timeout-duration=5s
# resilience4j.timelimiter.instances.orderService.timeout-duration=5s
# resilience4j.timelimiter.instances.paymentService.timeout-duration=5s

# # =============================================
# # LOGGING CONFIGURATION
# # =============================================
# logging.level.org.springframework.cloud.gateway=INFO
# logging.level.org.springframework.security=INFO
# logging.level.org.springframework.web=INFO
# logging.level.reactor.netty=INFO
# logging.level.io.github.resilience4j=INFO
# logging.pattern.level=%5p [${spring.application.name:},%X{traceId:-},%X{spanId:-}]

# # =============================================
# # NETWORK PREFERENCES
# # =============================================
# spring.cloud.inetutils.preferred-networks=192.168,10.0,172.16


# spring.cloud.gateway.globalcors.cors-configurations.[/**].allowed-origins[0]=http://localhost:3000
# spring.cloud.gateway.globalcors.cors-configurations.[/**].allowed-origins[1]=http://127.0.0.1:3000

# spring.cloud.gateway.globalcors.cors-configurations.[/**].allowed-methods[0]=GET
# spring.cloud.gateway.globalcors.cors-configurations.[/**].allowed-methods[1]=POST
# spring.cloud.gateway.globalcors.cors-configurations.[/**].allowed-methods[2]=PUT
# spring.cloud.gateway.globalcors.cors-configurations.[/**].allowed-methods[3]=DELETE
# spring.cloud.gateway.globalcors.cors-configurations.[/**].allowed-methods[4]=OPTIONS
# spring.cloud.gateway.globalcors.cors-configurations.[/**].allowed-methods[5]=PATCH

# spring.cloud.gateway.globalcors.cors-configurations.[/**].allowed-headers[0]=*
# spring.cloud.gateway.globalcors.cors-configurations.[/**].allow-credentials=true
# spring.cloud.gateway.globalcors.cors-configurations.[/**].max-age=3600
