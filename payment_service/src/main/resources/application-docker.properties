# =============================================
# SERVER CONFIGURATION
# =============================================
server.port=8082
server.forward-headers-strategy=framework
server.servlet.context-path=/

# =============================================
# SPRING APPLICATION
# =============================================
spring.application.name=payment-service

# =============================================
# DATASOURCE CONFIGURATION
# =============================================
spring.datasource.url=jdbc:mysql://mysql-db:3306/payment_service?useSSL=false&allowPublicKeyRetrieval=true&serverTimezone=Asia/Ho_Chi_Minh&characterEncoding=UTF-8
spring.datasource.username=${DB_USERNAME:root}
spring.datasource.password=${DB_PASSWORD:nguyenthuong01}
spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver

# Hikari Connection Pool
spring.datasource.hikari.maximum-pool-size=15
spring.datasource.hikari.minimum-idle=3
spring.datasource.hikari.connection-timeout=30000
spring.datasource.hikari.idle-timeout=600000
spring.datasource.hikari.max-lifetime=1800000
spring.datasource.hikari.pool-name=PaymentServiceHikariPool
spring.datasource.hikari.leak-detection-threshold=60000

# =============================================
# JPA CONFIGURATION
# =============================================
spring.jpa.hibernate.ddl-auto=update
spring.jpa.show-sql=${SHOW_SQL:false}
spring.jpa.open-in-view=false

# Hibernate Properties
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.MySQL8Dialect
spring.jpa.properties.hibernate.format_sql=true
spring.jpa.properties.hibernate.jdbc.batch_size=20
spring.jpa.properties.hibernate.jdbc.batch_versioned_data=true
spring.jpa.properties.hibernate.order_inserts=true
spring.jpa.properties.hibernate.order_updates=true
spring.jpa.properties.hibernate.connection.provider_disables_autocommit=true
spring.jpa.properties.hibernate.generate_statistics=false

# =============================================
# SPRING CLOUD CONFIGURATION
# =============================================
spring.cloud.loadbalancer.enabled=true
spring.cloud.circuitbreaker.resilience4j.enabled=true

# =============================================
# STRIPE CONFIGURATION
# =============================================
stripe.secret-key=${STRIPE_SECRET_KEY:sk_test_51SJs9MGORPQB7l1qVoer5jy9UnV5bG8Ynd082WOujXReJKFRD3CN4P72jcMOOQu468lcLQ8ZlpiFEbI2a27gYIaI0088VTVrBZ}
stripe.publishable-key=${STRIPE_PUBLISHABLE_KEY:pk_test_51SJs9MGORPQB7l1qcKjOvFVXwhI8IsIZlYhV4LGIEm8YxDjHY6qn4ab1W7wPxKPlkV6lDMDao8R09UwrUGp6qCmi00A94ZMW1Z}
stripe.webhook.secret=${STRIPE_WEBHOOK_SECRET:}
stripe.timeout.connect=10000
stripe.timeout.read=30000

# =============================================
# EUREKA CLIENT CONFIGURATION
# =============================================
eureka.client.service-url.defaultZone=http://eureka:password@hotel-booking-discovery:8671/eureka
eureka.client.registry-fetch-interval-seconds=10
eureka.client.initial-instance-info-replication-interval-seconds=5
eureka.client.register-with-eureka=true
eureka.client.fetch-registry=true

eureka.instance.hostname=payment-service
eureka.instance.prefer-ip-address=true
eureka.instance.instance-id=${spring.application.name}:${server.port}
eureka.instance.lease-renewal-interval-in-seconds=10
eureka.instance.lease-expiration-duration-in-seconds=30
eureka.instance.metadata-map.zone=primary
eureka.instance.metadata-map.version=1.0
eureka.instance.metadata-map.context-path=/
eureka.instance.metadata-map.secure=false
eureka.instance.health-check-url=http://${eureka.instance.hostname}:${server.port}/actuator/health
eureka.instance.status-page-url=http://${eureka.instance.hostname}:${server.port}/actuator/info
eureka.instance.home-page-url=http://${eureka.instance.hostname}:${server.port}/

# =============================================
# MANAGEMENT ENDPOINTS
# =============================================
management.endpoints.web.exposure.include=health,info,metrics,env,loggers
management.endpoints.web.base-path=/actuator
management.endpoints.web.cors.allowed-origins=*
management.endpoints.web.cors.allowed-methods=GET,POST
management.endpoints.enabled-by-default=true

management.endpoint.health.enabled=true
management.endpoint.health.show-details=always
management.endpoint.health.show-components=always
management.endpoint.metrics.enabled=true
management.endpoint.loggers.enabled=true

management.health.db.enabled=true
management.health.diskspace.enabled=true
management.health.readiness-state.enabled=true
management.health.liveness-state.enabled=true
management.health.stripe.enabled=true

management.info.env.enabled=true
management.info.stripe.enabled=true

# =============================================
# DISTRIBUTED TRACING
# =============================================
management.tracing.sampling.probability=1.0
management.zipkin.tracing.endpoint=http://zipkin:9411/api/v2/spans

# =============================================
# RESILIENCE4J CONFIGURATION FOR PAYMENT SERVICE
# =============================================
# Stripe Service Circuit Breaker
resilience4j.circuitbreaker.instances.stripe-service.register-health-indicator=true
resilience4j.circuitbreaker.instances.stripe-service.sliding-window-type=COUNT_BASED
resilience4j.circuitbreaker.instances.stripe-service.sliding-window-size=10
resilience4j.circuitbreaker.instances.stripe-service.minimum-number-of-calls=5
resilience4j.circuitbreaker.instances.stripe-service.failure-rate-threshold=50
resilience4j.circuitbreaker.instances.stripe-service.wait-duration-in-open-state=30s
resilience4j.circuitbreaker.instances.stripe-service.permitted-number-of-calls-in-half-open-state=3
resilience4j.circuitbreaker.instances.stripe-service.automatic-transition-from-open-to-half-open-enabled=true
resilience4j.circuitbreaker.instances.stripe-service.record-exceptions=java.io.IOException,java.util.concurrent.TimeoutException,org.springframework.web.client.ResourceAccessException,com.stripe.exception.StripeException,com.stripe.exception.APIConnectionException,com.stripe.exception.APIException
resilience4j.circuitbreaker.instances.stripe-service.ignore-exceptions=com.stripe.exception.CardException,com.stripe.exception.InvalidRequestException

# Stripe Service Time Limiter
resilience4j.timelimiter.instances.stripe-service.timeout-duration=15s

# Stripe Service Retry
resilience4j.retry.instances.stripe-service.max-attempts=3
resilience4j.retry.instances.stripe-service.wait-duration=2s
resilience4j.retry.instances.stripe-service.retry-exceptions=com.stripe.exception.APIConnectionException,java.net.SocketTimeoutException

# Stripe Service Bulkhead
resilience4j.bulkhead.instances.stripe-service.max-concurrent-calls=20
resilience4j.bulkhead.instances.stripe-service.max-wait-duration=50ms

# =============================================
# LOGGING CONFIGURATION
# =============================================
logging.level.com.payment.service=INFO
logging.level.com.stripe=WARN
logging.level.org.hibernate=WARN
logging.level.org.springframework.web=INFO
logging.level.org.springframework.cloud=INFO
logging.level.org.springframework.retry=INFO
logging.level.io.github.resilience4j=INFO

logging.pattern.level=%5p [${spring.application.name:},%X{traceId:-},%X{spanId:-}]
logging.pattern.console=%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg [%X{traceId:-},%X{spanId:-}]%n

logging.file.name=/app/logs/payment-service.log
logging.logback.rollingpolicy.max-file-size=10MB
logging.logback.rollingpolicy.max-history=30

# =============================================
# PAYMENT SERVICE CUSTOM CONFIGURATION
# =============================================
app.payment.timeout-seconds=300
app.payment.webhook-path=/api/payment/webhook
app.payment.retry.max-attempts=3
app.payment.retry.delay-ms=1000
app.payment.security.webhook-signature-header=Stripe-Signature

app.cors.allowed-origins=http://api-gateway:8900,http://localhost:3000,http://localhost:8900
app.cors.allowed-methods=GET,POST,PUT,DELETE,OPTIONS
app.cors.allowed-headers=*
app.cors.allow-credentials=true

# =============================================
# HTTP CLIENT CONFIGURATION
# =============================================
http.client.connect-timeout=10000
http.client.read-timeout=30000
http.client.max-connections=100
http.client.max-connections-per-route=20