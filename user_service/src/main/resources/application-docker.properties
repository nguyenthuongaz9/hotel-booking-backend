# =============================================
# SERVER CONFIGURATION
# =============================================
server.port=8081
server.forward-headers-strategy=framework
server.servlet.context-path=/

# =============================================
# SPRING APPLICATION
# =============================================
spring.application.name=user-service

# =============================================
# MONGODB CONFIGURATION
# =============================================
spring.data.mongodb.uri=mongodb://${MONGO_USERNAME:nguyenthuongaz9}:${MONGO_PASSWORD:nguyenthuong01}@mongodb:27017/hotelbooking?authSource=admin&authMechanism=SCRAM-SHA-256
spring.data.mongodb.auto-index-creation=true

# =============================================
# SPRING CLOUD CONFIGURATION
# =============================================
spring.cloud.loadbalancer.enabled=true
spring.cloud.circuitbreaker.resilience4j.enabled=true

# =============================================
# JWT CONFIGURATION
# =============================================
jwt.secret_key=${JWT_SECRET_KEY:c29tZXNlY3JldGtleWZvcmV4YW1wbGU}
jwt.expiration=${JWT_EXPIRATION:86400000}
jwt.issuer=user-service
jwt.header=Authorization
jwt.prefix=Bearer

# =============================================
# EUREKA CLIENT CONFIGURATION
# =============================================
eureka.client.service-url.defaultZone=http://eureka:password@localhost:8671/eureka/
eureka.client.registry-fetch-interval-seconds=10
eureka.client.initial-instance-info-replication-interval-seconds=5
eureka.client.register-with-eureka=true
eureka.client.fetch-registry=true

eureka.instance.hostname=user-service
eureka.instance.prefer-ip-address=true
eureka.instance.instance-id=${spring.application.name}:${server.port}
eureka.instance.lease-renewal-interval-in-seconds=10
eureka.instance.lease-expiration-duration-in-seconds=30
eureka.instance.metadata-map.zone=primary
eureka.instance.metadata-map.version=1.0
eureka.instance.metadata-map.context-path=/
eureka.instance.metadata-map.secure=false
eureka.instance.health-check-url=http://${eureka.instance.hostname}:${server.port}/actuator/health
eureka.instance.status-page-url=http://${eureka.instance.hostname}:${server.port}/actuator/info
eureka.instance.home-page-url=http://${eureka.instance.hostname}:${server.port}/

# =============================================
# MANAGEMENT ENDPOINTS
# =============================================
management.endpoints.web.exposure.include=health,info,metrics,env,loggers
management.endpoints.web.base-path=/actuator
management.endpoints.web.cors.allowed-origins=*
management.endpoints.web.cors.allowed-methods=GET,POST
management.endpoints.enabled-by-default=true

management.endpoint.health.enabled=true
management.endpoint.health.show-details=always
management.endpoint.health.show-components=always
management.endpoint.metrics.enabled=true
management.endpoint.loggers.enabled=true

management.health.mongo.enabled=true
management.health.diskspace.enabled=true
management.health.readiness-state.enabled=true
management.health.liveness-state.enabled=true

management.info.env.enabled=true
management.info.mongo.enabled=true

# =============================================
# DISTRIBUTED TRACING
# =============================================
management.tracing.sampling.probability=1.0
management.zipkin.tracing.endpoint=http://zipkin:9411/api/v2/spans

# =============================================
# RESILIENCE4J CONFIGURATION FOR USER SERVICE
# =============================================
# Auth Service Circuit Breaker
resilience4j.circuitbreaker.instances.auth-service.register-health-indicator=true
resilience4j.circuitbreaker.instances.auth-service.sliding-window-type=COUNT_BASED
resilience4j.circuitbreaker.instances.auth-service.sliding-window-size=10
resilience4j.circuitbreaker.instances.auth-service.minimum-number-of-calls=5
resilience4j.circuitbreaker.instances.auth-service.failure-rate-threshold=50
resilience4j.circuitbreaker.instances.auth-service.wait-duration-in-open-state=30s
resilience4j.circuitbreaker.instances.auth-service.permitted-number-of-calls-in-half-open-state=3
resilience4j.circuitbreaker.instances.auth-service.automatic-transition-from-open-to-half-open-enabled=true
resilience4j.circuitbreaker.instances.auth-service.record-exceptions=java.io.IOException,java.util.concurrent.TimeoutException,org.springframework.web.client.ResourceAccessException,org.springframework.dao.DataAccessException
resilience4j.circuitbreaker.instances.auth-service.ignore-exceptions=org.springframework.security.authentication.BadCredentialsException,org.springframework.security.core.AuthenticationException

# Auth Service Time Limiter
resilience4j.timelimiter.instances.auth-service.timeout-duration=10s

# Auth Service Retry
resilience4j.retry.instances.auth-service.max-attempts=3
resilience4j.retry.instances.auth-service.wait-duration=1s
resilience4j.retry.instances.auth-service.retry-exceptions=org.springframework.dao.TransientDataAccessException,java.net.SocketTimeoutException

# Auth Service Bulkhead
resilience4j.bulkhead.instances.auth-service.max-concurrent-calls=25
resilience4j.bulkhead.instances.auth-service.max-wait-duration=100ms

# =============================================
# LOGGING CONFIGURATION
# =============================================
logging.level.com.user.service=INFO
logging.level.org.springframework.data.mongodb=INFO
logging.level.org.springframework.security=INFO
logging.level.org.springframework.web=INFO
logging.level.org.springframework.cloud=INFO
logging.level.io.github.resilience4j=INFO

logging.pattern.level=%5p [${spring.application.name:},%X{traceId:-},%X{spanId:-}]
logging.pattern.console=%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg [%X{traceId:-},%X{spanId:-}]%n

logging.file.name=/app/logs/user-service.log
logging.logback.rollingpolicy.max-file-size=10MB
logging.logback.rollingpolicy.max-history=30

# =============================================
# SECURITY CONFIGURATION
# =============================================
spring.security.oauth2.resourceserver.jwt.enabled=false
spring.main.allow-bean-definition-overriding=true

# =============================================
# USER SERVICE CUSTOM CONFIGURATION
# =============================================
app.security.password.encoder-strength=10
app.security.token.refresh-expiration=604800000

app.cors.allowed-origins=http://api-gateway:8900,http://localhost:3000,http://localhost:8900,http://localhost:3001
app.cors.allowed-methods=GET,POST,PUT,DELETE,OPTIONS,PATCH
app.cors.allowed-headers=*
app.cors.allow-credentials=true
app.cors.max-age=3600

app.cache.user.ttl-minutes=30
app.cache.user.max-size=1000

# MongoDB Custom Configuration
app.mongodb.connection-pool.min-size=10
app.mongodb.connection-pool.max-size=100
app.mongodb.connection-pool.max-wait-time=120000